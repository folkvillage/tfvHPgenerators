新村ホームページ案
===

新しい村のホームページを作るために、いろいろ模索するところ。

ぶっ壊れても、前の状態に戻せるので、遠慮無くこねこねしましょう。
基本的にsrc内をこねこねします。


## リンク

- [HP案のメモ(Evernoteへ飛びます)](https://www.evernote.com/shard/s202/sh/b0a401db-9ffa-4177-a6b5-057a31cc75f4/d31221ed8537639d127cfa909ee6b229)


## src内のhtmlの書き方

srcの中へ、htmlを書いていきますが、普通のhtmlとは少し違った書き方となっています。
(rubyの標準ライブラリERBの機能を使った書き方をします)
そして、そんなに長々と書かなくて良くなっていて、「**default.html.erb**」(すべてのページで共通な部分)に書いてあることは書かなくて良くなっています。
拡張子は、.html.erbとして保存してください。
src内の.html.erbファイルは、generate.rbによって処理されて\_siteフォルダ内へhtmlとして出力されます。

各ページのタイトルなどを設定することができます。
html.erbの先頭に、以下のようにページごとの設定を書くことができます。
	
	<%
		page[:title] = "(ページタイトル)"
		page[:(任意の識別名)] = "(値)"
	%>

ページのレイアウトを組むときは、tableタグは使わず、divタグを使ってください。

#####ERBの書き方、意味

基本的にはhtmlをそのまま書きます。
「<% %>」の中にrubyのコードを書いてgenerateするときに実行させることができます。
「<%= %>」の中に変数や関数を書いて、その場所にそれを展開することができます。
generate.rbでは以下のように展開されます。
	
	<%= content %>                default.html.erb内に一箇所だけあります。ここへ処理対象の.html.erbの内容が入ります。
	<%= rootdir %>                ドキュメントルートの位置が埋め込まれます。絶対パスでURLを指定したい場合に使います。
	<%= tableFromCSV() %>         CSVからtableタグを生成して埋め込みます。詳しい使い方はgenerate.rbを見てください。
	<%= alink() %>                javascriptの関数を呼ぶaタグを作ります。(リンク先へ飛ばずに指定した関数を実行します)
	<%= page[:(任意の識別名)] %>  ソースファイルごとに変数を定義できます。ソースファイル内に「<% page[:(任意の識別名)] = "値" %>」の書式で定義してください。
	<%= page[:title] %>           ここへページのタイトルが埋め込まれます。

erbについて詳しくはググってください。


### src内のhtml以外のファイルについて
src内の**html,css以外**のファイルは、そのまま\_siteへコピーされます。


## default.html.erb と generate.rb
default.html.erbとgenerate.rbを覗くと、どのようにページが生成されるかわかります。
`./generate.rb -h`を実行するとヘルプが見れます。



## ローカルテスト

アップロードする前に自分のPCで確認することができます。

1. server.rbを起動させておく。端末でfmuraのディレクトリに移動し以下を実行。
	`$ ./server.rb`
2. <http://localhost:8000/>へアクセスすることで、\_siteの中身をブラウザで確認できる。
3. srcを編集したら、別端末で`./generate.rb`を実行し更新します。
4. サーバーを終了させるには、端末上で「*Ctrl+C*」を入力します。



## ファイル構成

| **fmura/**     |                |
| -------------- | -------------- |
|  **\_site/**   | 実際のサイトのルートディレクトリ。  |
|  -**src/**      | htmlの断片を書く。基本この中を編集する。 |
|  --default.html.erb  | サイトのテンプレートとなるページ。  |
|  -*generate.rb* | srcの中身に処理を加えて\_siteへ完成されたページを作る。 |
|  -*.login.rb* | ログイン認証処理を行う。generate.rbからrequireされています。 | 
|  *server.rb*   | ローカルテスト用にサーバーを稼働させる。  |
|  .htaccess     | apache用設定ファイル  |
|  README        | これ  |

src/ 以下には、.html.erbファイルか、.rbファイルしか置かないようにします。
generate.rbは、その2種類の拡張子を持つファイルしか処理しません。
\_site/ 以下の.htmlファイルは、generate.rbによって上書きされるので、編集したい場合は、src内の.html.erbファイルを編集しましょう。
js,cssファイルは直接編集して大丈夫です。

トップページに表示されるスライドショー用の画像は、img/top\_image/に用意してください。(page\_setting.rb で変更可能)
README.txtにある通りの画像を用意してください。



## ログイン用IDとパスワードの更新方法
`generate.rb pass`を使います

1. .login.rbを編集する(ユーザーを追加しないなら2へ)
	LoginUserに新しいユーザー識別名を追加する。(すきな名前でよい)
2. `./generate.rb pass [ユーザー識別名] [新しいID] [新しいpass]`を実行する。
	画面にハッシュ化したパスワードがユーザー数分表示される
3. ハッシュを data/.login/.ht\_pass へコピペする。
	ここは、手動でやってください。
4. data/.login/.ht\_pass と .login.rb をアップロードする。



------------------------------------------------------------------------

## 新しくライブレポートのベージを追加しました

村のライブのページ生成とほぼ同じコードを使っています。
はりぼてなので、どこかで不具合が生じるかもしれません。
いろいろ改良の余地有りなので、気が向いたら改良してください〜〜〜〜〜！！

